<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bureau Report - {{ report.meta.customer_id|mask_id }}</title>
    <script>{% autoescape false %}{% include 'chart.min.js' %}{% endautoescape %}</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            font-size: 14px;
            line-height: 1.5;
        }

        .header {
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            color: #666;
            font-size: 13px;
        }

        .header-meta span {
            display: inline-block;
        }

        .section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }

        .section h3 {
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin-bottom: 12px;
        }

        .summary-box {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
        }

        .summary-box p {
            margin: 0;
            color: #444;
            white-space: pre-line;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .info-item {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .info-item label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .info-item .value {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .info-item .value.risk {
            color: #e74c3c;
        }

        .info-item .value.safe {
            color: #27ae60;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }

        th, td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .amount {
            text-align: right;
            font-family: 'Consolas', monospace;
        }

        .center {
            text-align: center;
        }

        .secured-yes {
            color: #27ae60;
            font-weight: 600;
        }

        .secured-no {
            color: #e67e22;
            font-weight: 600;
        }

        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #999;
            font-size: 11px;
        }

        /* ── charts ────────────────────────────── */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 10px;
        }

        .chart-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px 12px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chart-card h4 {
            font-size: 13px;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 700;
        }

        .chart-card canvas {
            max-width: 220px;
            max-height: 220px;
        }

        .chart-timeseries {
            grid-column: 1 / -1;
            width: 100%;
        }

        .chart-timeseries canvas {
            max-width: 100% !important;
            max-height: none !important;
            width: 100% !important;
            height: 300px !important;
        }

        @media print {
            body {
                padding: 0;
            }
            .section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Bureau Tradeline Report</h1>
        <div class="header-meta">
            <span><strong>Customer ID:</strong> {{ report.meta.customer_id|mask_id }}</span>
            <span><strong>Generated:</strong> {{ report.meta.generated_at[:10] }}</span>
            <span><strong>Currency:</strong> {{ report.meta.currency }}</span>
            <span><strong>Tradelines:</strong> {{ report.executive_inputs.total_tradelines }}</span>
        </div>
    </div>

    <!-- Portfolio Summary -->
    <div class="section">
        <h3>Portfolio Summary</h3>
        <div class="info-grid">
            <div class="info-item">
                <label>Total / Live Tradelines</label>
                <div class="value">{{ report.executive_inputs.total_tradelines }} / {{ report.executive_inputs.live_tradelines }}</div>
            </div>
            <div class="info-item">
                <label>Total Sanction Amount</label>
                <div class="value">INR {{ report.executive_inputs.total_sanctioned|inr_units }}</div>
            </div>
            <div class="info-item">
                <label>Total Outstanding</label>
                <div class="value">
                    INR {{ report.executive_inputs.total_outstanding|inr_units }}
                    {% if report.executive_inputs.total_sanctioned > 0 %}
                        <span style="font-size: 13px; color: #666; font-weight: 400;">({{ "%.0f"|format(report.executive_inputs.total_outstanding / report.executive_inputs.total_sanctioned * 100) }}% of sanctioned)</span>
                    {% endif %}
                </div>
            </div>
            <div class="info-item">
                <label>Unsecured Sanction Amount</label>
                <div class="value">
                    INR {{ report.executive_inputs.unsecured_sanctioned|inr_units }}
                    {% if report.executive_inputs.total_sanctioned > 0 %}
                        <span style="font-size: 13px; color: #666; font-weight: 400;">({{ "%.0f"|format(report.executive_inputs.unsecured_sanctioned / report.executive_inputs.total_sanctioned * 100) }}% of total)</span>
                    {% endif %}
                </div>
            </div>
            <div class="info-item">
                <label>Unsecured Outstanding</label>
                <div class="value">
                    INR {{ report.executive_inputs.unsecured_outstanding|inr_units }}
                    <span style="font-size: 13px; color: #666; font-weight: 400;">
                        {% if report.executive_inputs.total_outstanding > 0 %}
                            ({{ "%.0f"|format(report.executive_inputs.unsecured_outstanding / report.executive_inputs.total_outstanding * 100) }}% of outstanding
                        {% endif %}
                        {% if report.executive_inputs.total_sanctioned > 0 %}
                            {% if report.executive_inputs.total_outstanding > 0 %} | {% else %}({% endif %}{{ "%.0f"|format(report.executive_inputs.unsecured_outstanding / report.executive_inputs.total_sanctioned * 100) }}% of sanctioned)
                        {% elif report.executive_inputs.total_outstanding > 0 %}
                            )
                        {% endif %}
                    </span>
                </div>
            </div>
            <div class="info-item">
                <label>Max DPD</label>
                <div class="value {% if report.executive_inputs.max_dpd and report.executive_inputs.max_dpd > 30 %}risk{% endif %}">
                    {% if report.executive_inputs.max_dpd is not none %}
                        {{ report.executive_inputs.max_dpd }}
                        {% if report.executive_inputs.max_dpd_months_ago is not none or report.executive_inputs.max_dpd_loan_type %}
                            <span style="font-size: 12px; color: #666;">({% if report.executive_inputs.max_dpd_months_ago is not none %}{{ report.executive_inputs.max_dpd_months_ago }} months ago{% endif %}{% if report.executive_inputs.max_dpd_months_ago is not none and report.executive_inputs.max_dpd_loan_type %}, {% endif %}{% if report.executive_inputs.max_dpd_loan_type %}{{ report.executive_inputs.max_dpd_loan_type }}{% endif %})</span>
                        {% endif %}
                    {% else %}
                        N/A
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Visualizations -->
    {% if chart_data %}
    <div class="section">
        <h3>Portfolio Visualizations</h3>
        <div class="charts-grid">

            <!-- 1. Product Mix by Count -->
            <div class="chart-card">
                <h4>Product Mix by Count</h4>
                <canvas id="chartProductMix" width="220" height="220"></canvas>
            </div>

            <!-- 2. Secured vs Unsecured -->
            <div class="chart-card">
                <h4>Secured vs Unsecured</h4>
                <canvas id="chartSecured" width="220" height="220"></canvas>
            </div>

            <!-- 3. On-Us vs Off-Us -->
            <div class="chart-card">
                <h4>On-Us vs Off-Us</h4>
                <canvas id="chartOnUs" width="220" height="220"></canvas>
            </div>

            <!-- 4. Unsecured Outstanding by Product -->
            <div class="chart-card">
                <h4>Unsecured Outstanding by Product</h4>
                <canvas id="chartUnsecOut" width="220" height="220"></canvas>
            </div>

            <!-- 5. Portfolio Exposure Over Time (full-width stacked area chart) -->
            <div class="chart-card chart-timeseries">
                <h4>Portfolio Exposure Over Time (Stacked by Product)</h4>
                <canvas id="chartTimeseries"></canvas>
            </div>

        </div>
    </div>

    <script>
    (function() {
        // chart_data is a pre-serialized JSON string from Python — no tojson needed
        const CD = {{ chart_data | safe }};

        const PALETTE = [
            "#3498db","#e74c3c","#2ecc71","#f39c12",
            "#9b59b6","#1abc9c","#e67e22","#34495e",
            "#e91e63","#00bcd4","#ff5722","#607d8b","#795548"
        ];
        const SECURED_COLORS     = ["#27ae60","#e67e22"];
        const LIVE_CLOSED_COLORS = ["#3498db","#95a5a6"];
        const ONUS_COLORS        = ["#8e44ad","#1abc9c"];

        const COMMON_OPTS = {
            responsive: false,
            plugins: {
                legend: { position: "bottom", labels: { font: { size: 11 }, boxWidth: 12, padding: 8 } },
                tooltip: { callbacks: { label: ctx => ` ${ctx.label}: ${ctx.parsed}` } }
            },
        };

        function mkDonut(canvasId, labels, values, colors) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            const filtered = labels.map((l,i) => [l, values[i], colors[i % colors.length]])
                                   .filter(x => x[1] > 0);
            if (!filtered.length) { ctx.parentElement.innerHTML += "<p style='color:#aaa;font-size:12px;'>No data</p>"; return; }
            new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: filtered.map(x => x[0]),
                    datasets: [{ data: filtered.map(x => x[1]), backgroundColor: filtered.map(x => x[2]),
                                 borderWidth: 2, borderColor: "#fff", hoverOffset: 6 }]
                },
                options: { ...COMMON_OPTS, cutout: "55%" }
            });
        }

        mkDonut("chartProductMix", CD.product_mix.labels,   CD.product_mix.values,   PALETTE);
        mkDonut("chartSecured",    CD.secured_split.labels, CD.secured_split.values, SECURED_COLORS);
        mkDonut("chartOnUs",       CD.onus_offus.labels,    CD.onus_offus.values,    ONUS_COLORS);

        // Unsecured outstanding donut — INR-formatted tooltip
        (function() {
            const uo = CD.unsec_outstanding;
            const ctx = document.getElementById("chartUnsecOut");
            if (!ctx) return;
            if (!uo || !uo.labels.length) { ctx.parentElement.innerHTML += "<p style='color:#aaa;font-size:12px;'>No data</p>"; return; }
            const fmt = v => v >= 1e7 ? (v/1e7).toFixed(2)+" Cr" : v >= 1e5 ? (v/1e5).toFixed(2)+" L" : String(v);
            new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: uo.labels,
                    datasets: [{ data: uo.values, backgroundColor: uo.labels.map((_, i) => PALETTE[i % PALETTE.length]),
                                 borderWidth: 2, borderColor: "#fff", hoverOffset: 6 }]
                },
                options: {
                    ...COMMON_OPTS, cutout: "55%",
                    plugins: {
                        legend: COMMON_OPTS.plugins.legend,
                        tooltip: { callbacks: { label: c => ` ${c.label}: ${fmt(c.parsed)}` } },
                    },
                },
            });
        })();

        // Stacked area chart — portfolio exposure over time
        (function() {
            const ts = CD.timeseries;
            const ctx = document.getElementById("chartTimeseries");
            if (!ctx || !ts || !ts.months.length) return;
            const fmt = v => v >= 1e7 ? (v/1e7).toFixed(2)+" Cr" : v >= 1e5 ? (v/1e5).toFixed(2)+" L" : String(v);
            // Sort largest exposure to bottom of stack (most stable base)
            const entries = Object.entries(ts.series)
                .map(([name, vals]) => [name, vals, vals.reduce((a, b) => a + b, 0)])
                .sort((a, b) => b[2] - a[2]);
            const datasets = entries.map(([name, vals], i) => ({
                label: name,
                data: vals,
                borderColor: PALETTE[i % PALETTE.length],
                backgroundColor: PALETTE[i % PALETTE.length] + "55",
                tension: 0.3, fill: true, pointRadius: 0, pointHoverRadius: 4, borderWidth: 1.5,
            }));
            new Chart(ctx, {
                type: "line",
                data: { labels: ts.months, datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: "index", intersect: false },
                    plugins: {
                        legend: { position: "top", labels: { font: { size: 10 }, boxWidth: 12, padding: 10 } },
                        tooltip: {
                            callbacks: {
                                label: c => ` ${c.dataset.label}: ${fmt(c.parsed.y)}`,
                                footer: items => `Total: ${fmt(items.reduce((s, c) => s + c.parsed.y, 0))}`,
                            },
                        },
                    },
                    scales: {
                        x: { ticks: { font: { size: 9 }, maxRotation: 45, autoSkip: true, maxTicksLimit: 12 } },
                        y: { stacked: true, ticks: { font: { size: 10 }, callback: fmt }, beginAtZero: true },
                    },
                },
            });
        })();
    })();
    </script>
    {% endif %}

    <!-- Executive Summary (LLM narrative) -->
    {% if report.narrative %}
    <div class="section">
        <h3>Executive Summary</h3>
        <div class="summary-box">
            <p>{{ report.narrative }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Key Findings & Inferences -->
    {% if key_findings %}
    <div class="section">
        <h3>Key Findings & Inferences</h3>
        <div style="margin-top: 10px;">
            {% for finding in key_findings %}
            <div style="display: flex; align-items: flex-start; margin-bottom: 10px; padding: 10px; border-left: 4px solid {% if finding.severity == 'high_risk' %}#e74c3c{% elif finding.severity == 'moderate_risk' %}#e67e22{% elif finding.severity == 'concern' %}#f39c12{% elif finding.severity == 'positive' %}#27ae60{% else %}#95a5a6{% endif %}; background-color: #f8f9fa; border-radius: 0 4px 4px 0;">
                <div style="flex: 1;">
                    <div style="margin-bottom: 4px;">
                        <span style="font-size: 11px; color: #666;">{{ finding.category }}</span>
                    </div>
                    <div style="font-weight: 600; color: #2c3e50; font-size: 13px;">{{ finding.finding }}</div>
                    <div style="color: #555; font-size: 12px; margin-top: 3px; font-style: italic;">{{ finding.inference }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Product-wise Breakdown Table -->
    {% if vectors_data %}
    <div class="section">
        <h3>Product-wise Breakdown</h3>
        <table>
            <thead>
                <tr>
                    <th>Loan Type</th>
                    <th class="center">Secured</th>
                    <th class="center">Count</th>
                    <th class="center">Live</th>
                    <th class="center">Closed</th>
                    <th class="amount">Sanctioned</th>
                    <th class="amount">Outstanding</th>
                    <th class="center">Max DPD</th>
                    <th class="center">Util %</th>
                    <th class="center">On-Us</th>
                </tr>
            </thead>
            <tbody>
                {% for vec in vectors_data %}
                <tr>
                    <td>{{ vec.loan_type_display }}</td>
                    <td class="center {% if vec.secured %}secured-yes{% else %}secured-no{% endif %}">
                        {{ "Yes" if vec.secured else "No" }}
                    </td>
                    <td class="center">{{ vec.loan_count }}</td>
                    <td class="center">{{ vec.live_count }}</td>
                    <td class="center">{{ vec.closed_count }}</td>
                    <td class="amount">{{ vec.total_sanctioned_amount|inr }}</td>
                    <td class="amount">{{ vec.total_outstanding_amount|inr }}</td>
                    <td class="center">{{ vec.max_dpd if vec.max_dpd is not none else "-" }}</td>
                    <td class="center">{{ "{:.0f}".format(vec.utilization_ratio * 100) if vec.utilization_ratio is not none else "-" }}</td>
                    <td class="center">{{ vec.on_us_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Behavioral & Risk Features -->
    {% if tl_features %}
    <div class="section">
        <h3>Behavioral & Risk Features</h3>

        <!-- Loan Activity -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">Loan Activity</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>Months Since Last PL Trade</label>
                <div class="value">{{ "%.2f"|format(tl_features.months_since_last_trade_pl) if tl_features.months_since_last_trade_pl is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Months Since Last Unsecured Trade</label>
                <div class="value">{{ "%.2f"|format(tl_features.months_since_last_trade_uns) if tl_features.months_since_last_trade_uns is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>New PL Trades (6M)</label>
                <div class="value">{{ tl_features.new_trades_6m_pl if tl_features.new_trades_6m_pl is not none else "N/A" }}</div>
            </div>
        </div>

        <!-- DPD & Delinquency -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">DPD & Delinquency</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>Max DPD 6M (CC)</label>
                <div class="value {% if tl_features.max_dpd_6m_cc is not none and tl_features.max_dpd_6m_cc > 0 %}risk{% else %}safe{% endif %}">
                    {{ tl_features.max_dpd_6m_cc if tl_features.max_dpd_6m_cc is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>Max DPD 6M (PL)</label>
                <div class="value {% if tl_features.max_dpd_6m_pl is not none and tl_features.max_dpd_6m_pl > 0 %}risk{% else %}safe{% endif %}">
                    {{ tl_features.max_dpd_6m_pl if tl_features.max_dpd_6m_pl is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>Max DPD 9M (CC)</label>
                <div class="value {% if tl_features.max_dpd_9m_cc is not none and tl_features.max_dpd_9m_cc > 0 %}risk{% else %}safe{% endif %}">
                    {{ tl_features.max_dpd_9m_cc if tl_features.max_dpd_9m_cc is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>Months Since Last 0+ DPD (Unsecured)</label>
                <div class="value">{{ "%.2f"|format(tl_features.months_since_last_0p_uns) if tl_features.months_since_last_0p_uns is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Months Since Last 0+ DPD (PL)</label>
                <div class="value">{{ "%.2f"|format(tl_features.months_since_last_0p_pl) if tl_features.months_since_last_0p_pl is not none else "N/A" }}</div>
            </div>
        </div>

        <!-- Payment Behavior -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">Payment Behavior</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>% 0+ DPD in 24M (All)</label>
                <div class="value {% if tl_features.pct_0plus_24m_all is not none and tl_features.pct_0plus_24m_all > 0 %}risk{% else %}safe{% endif %}">
                    {{ "%.2f"|format(tl_features.pct_0plus_24m_all) if tl_features.pct_0plus_24m_all is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>% 0+ DPD in 24M (PL)</label>
                <div class="value {% if tl_features.pct_0plus_24m_pl is not none and tl_features.pct_0plus_24m_pl > 0 %}risk{% else %}safe{% endif %}">
                    {{ "%.2f"|format(tl_features.pct_0plus_24m_pl) if tl_features.pct_0plus_24m_pl is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>% Missed Payments (18M)</label>
                <div class="value {% if tl_features.pct_missed_payments_18m is not none and tl_features.pct_missed_payments_18m > 0 %}risk{% else %}safe{% endif %}">
                    {{ "%.2f"|format(tl_features.pct_missed_payments_18m) if tl_features.pct_missed_payments_18m is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>% Trades 0+ DPD in 12M (All)</label>
                <div class="value">{{ "%.2f"|format(tl_features.pct_trades_0plus_12m) if tl_features.pct_trades_0plus_12m is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Ratio Good Closed Loans (PL)</label>
                <div class="value {% if tl_features.ratio_good_closed_pl is not none and tl_features.ratio_good_closed_pl >= 0.8 %}safe{% elif tl_features.ratio_good_closed_pl is not none and tl_features.ratio_good_closed_pl < 0.5 %}risk{% endif %}">
                    {{ "%.0f%%"|format(tl_features.ratio_good_closed_pl * 100) if tl_features.ratio_good_closed_pl is not none else "N/A" }}
                </div>
            </div>
        </div>

        <!-- Utilization -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">Utilization</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>CC Balance Utilization %</label>
                <div class="value {% if tl_features.cc_balance_utilization_pct is not none and tl_features.cc_balance_utilization_pct > 75 %}risk{% elif tl_features.cc_balance_utilization_pct is not none and tl_features.cc_balance_utilization_pct <= 30 %}safe{% endif %}">
                    {{ "%.2f"|format(tl_features.cc_balance_utilization_pct) if tl_features.cc_balance_utilization_pct is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>PL Balance Remaining %</label>
                <div class="value">{{ "%.2f"|format(tl_features.pl_balance_remaining_pct) if tl_features.pl_balance_remaining_pct is not none else "N/A" }}</div>
            </div>
        </div>

        <!-- Enquiry Behavior -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">Enquiry Behavior</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>Unsecured Enquiries (12M)</label>
                <div class="value {% if tl_features.unsecured_enquiries_12m is not none and tl_features.unsecured_enquiries_12m > 10 %}risk{% elif tl_features.unsecured_enquiries_12m is not none and tl_features.unsecured_enquiries_12m <= 3 %}safe{% endif %}">
                    {{ tl_features.unsecured_enquiries_12m if tl_features.unsecured_enquiries_12m is not none else "N/A" }}
                </div>
            </div>
            <div class="info-item">
                <label>Trade-to-Enquiry Ratio (Unsec 24M)</label>
                <div class="value">{{ "%.2f"|format(tl_features.trade_to_enquiry_ratio_uns_24m) if tl_features.trade_to_enquiry_ratio_uns_24m is not none else "N/A" }}</div>
            </div>
        </div>

        <!-- Loan Acquisition Velocity -->
        <h4 style="color: #2c3e50; margin: 15px 0 8px 0; font-size: 14px;">Loan Acquisition Velocity</h4>
        <div class="info-grid">
            <div class="info-item">
                <label>Interpurchase Time 12M (PL/BL)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_12m_plbl) if tl_features.interpurchase_time_12m_plbl is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 6M (PL/BL)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_6m_plbl) if tl_features.interpurchase_time_6m_plbl is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 24M (All)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_24m_all) if tl_features.interpurchase_time_24m_all is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 9M (HL/LAP)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_9m_hl_lap) if tl_features.interpurchase_time_9m_hl_lap is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 24M (HL/LAP)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_24m_hl_lap) if tl_features.interpurchase_time_24m_hl_lap is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 24M (TWL)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_24m_twl) if tl_features.interpurchase_time_24m_twl is not none else "N/A" }}</div>
            </div>
            <div class="info-item">
                <label>Interpurchase Time 12M (Consumer Loan)</label>
                <div class="value">{{ "%.2f"|format(tl_features.interpurchase_time_12m_cl) if tl_features.interpurchase_time_12m_cl is not none else "N/A" }}</div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="footer">
        <p>Generated on {{ report.meta.generated_at[:10] }} | Currency: {{ report.meta.currency }}</p>
    </div>
</body>
</html>
